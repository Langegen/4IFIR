# Гайд по тонкой настройке 4IFIR WIZARD

## Советы перед настройкой
* Используйте EMUNAND
* Сделайте бекап сохранений 
* Установите игры для проверки стабильности настроек
* Текущие параметры, установленные в 4IFIR WIZARD, хранятся в файле atmosphere\kips\loader.kip
* Если после изменения какого-то из параметров перестала включаться консоль - верните предыдущее значение через safe-mode
* Если не получилось откатить изменения через safe-mode, то используйте KipTool - это payload-based инструмент, позволяющий редактировать значение параметров в вашем `loader.kip` файле.
Инструкцию по установке и использованию можно найти на [странице проекта](https://github.com/kawaii-flesh/KipTool)
* следует установить HB Menu как приложение [.nsp файл по ссылке](https://t.me/kf4fr/48074/547847). Далее все манипуляции и тесты следует проводить именно в нем.
* Для проверки параметров на стабильность, сначала запускаем - MicroMemBench. Если все ОК, то можно переходить к тестам в игре, для этого хорошо подойдет Red Dead Redemption, игра хорошо нагружает консоль.
Для большей нагрузки, можно перевести консоль в docked mode с помощью ReversNX. Для каждого теста будет достаточно 15-20 минут игры.

## 4IFIR WIZARD

### CPU
Начать рекоммендую с настроек CPU, так как CPU не зависит от RAM и GPU. Поэтому даже если вы в будующем захотите сделать себе новый кип (более экономичный или более производительный), 
то раздел CPU вап перенастраивать не придется.  
Если какой то из параметров будет "перекручен", то консоль скорее всего просто зависнет после лого атмосферы. Поэтому загружаемся в СейфМод и возвращаем параметр в предыдущее значение
***
**Переходим в 4advanced - CPU**
* CPU Minimal Voltage – выбор нижнего порога потребления процессора.   
>Чем ниже напряжение, тем меньше потребление. Выставляем его на шаг ниже (например, было 620, стало 590 мВ). Перезагружаем систему и проводим тесты.  
>Тесты проводим в играх, выставляя минимальную частоту через    
>4IFIR Miracle -> Temporary overrides -> CPU  
>Если все хорошо, опускаем напряжение еще ниже и так далее, пока система работает.     
>Фиксируем значение и оставляем его.   
* CPU Maximum Voltage – выбор верхнего порога потребления процессора.  
**Рекомендуется оставить значение eBamatic**    
>Повышаем напряжение на 1 шаг, перезагружаемся и тестируем в CPU-зависимых играх (RDR, Hogwarts Legacy, No Man's Sky) в режиме 4IFIR Maximized на CPU. Повышаем до тех пор, пока все работает. `
* dCPUv - корректировка напряжений в диапазоне частот от 12хх до 18хх MHz  
**Рекомендуется оставить значение eBamatic**
>Действовать нужно с осторожностью и на свой страх и риск. Хотя катастрофических последствий быть не должно, ошибки в работе игры и операционной системы возможны.
  Перед редактированием рекомендуется сделать бекап конфигурации, чтобы не пересоздавать ее заново. Откатить изменения в конфигураторе не получится.
  За отправную точку можно взять напряжение 780mV и затем снижать или повышать его на один шаг по мере прохождения тестов (чем меньше напряжение, тем меньше потребление).
  Обязательно протестируйте работу с разгоном оперативной памяти и отключенным CPU Freq Governor в диапазоне частот 12хх-18ххMHz в CPU-интенсивных играх!
* CPU Boost Clock – выбор частоты до которой будет разгонятся игра на загрузочных экранах.  
**Рекомендуется оставить значение eBamatic**
>Можно выставить максимальное значение, но eBamatic - стабильнее 
* Low Mhz Undervolt – уровни андервольта для частот процессора ниже <=15хх Mhz.  
>Чем выше значение, тем ниже потребление на частотах до 15ххMHz. Выставляем на шаг выше, тестируем в играх на частотах до 15ххMHz с выключенным Governor    
>4IFIR Miracle -> Edit app Profile -> CPU Freq Governor -> Off    
>Повышаем значения до тех пор пока работает.  
* High Mhz Undervolt – уровни андервольта для частот процессора выше >15хх Mhz.    
**Рекомендуется оставить значение eBamatic**  
>Чем выше значение, тем ниже потребление на частотах выше 15xxMhz. 
>Выставляем на шаг выше, тестируем в CPU зависимых играх (Metro, Hogwarts Legacy, No Man's sky) на частотах выше 15ххMHz с выключенным Governor. Повышаем до тех пор, пока все работает. Рекомендуется тестировать в режиме 4IFIR MAXIMIZED:  
>4IFIR Miracle -> Temporary overrides -> CPU -> 4IFIR MAXIMIZED
* Speed Shift - понижение напряжения (потребления) вторичных компонентов консоли. Чем выше значение, тем ниже потребление.  
 **Рекомендуется оставить значение eBamatic**
>Чем выше значение, тем ниже потребление 
>Выставляем на шаг выше, тестируем

### GPU
Далее можно перейти к настройке GPU   
Тесты можно проводить только в играх, так как MemBench не задействует GPU
Принцип работы волтажей GPU:
GPUv Min - зависит от текущей частоты RAM, но так как теперь этот параметр адаптивный, то заморачиваться на этом не стоит. (для справки)
На вольтажи GPU влияют 2 параметра - GPUv Min (1й приоритет) и Gpu Eco Mode (2й приоритет);  
От самой минимальной частоты GPU - до *xxx*MHz (это частота которую предстоит вычислить опытным путем) используются вольтажи GPUv Min  
На всех остальных частотах GPU используются вольтажи из таблицы Gpu Eco Mode  
Оибки связаные с "перекручеными" настройками GPU, обычно выглядят в виде артефактов в играх(нарушение целостности текстур, непонятные сверкающие точки, изменение текстур). Так же могут сопровождаться оранжевым экраном.
***
**Переходим в раздел SmartMode-QuickTune-GPU**
* GPUv Mode – уровни самого минимального значения потребления видеокарты.   
>Чем выше Stage, тем ниже напряжение и меньше потребление.    
>Повышаем значение на шаг и перезагружаемся. Система работает? Отлично!  
>Запускаем GPU-интенсивные игры (Astral Chain, No Man's Sky, Hogwarts Legacy).  
>Теперь мы в игре и должны узнать, до какой частоты работает наш GPU при минимальном напряжении, которое мы выставили в этом пункте. Но перед этим, для тестов, нужно отключить GPU Freq Governor: 4IFIR Miracle -> Edit app Profile -> GPU Freq Governor -> Off;  
>Устанавливаем частоту GPU: 4IFIR Miracle -> Temporary overrides -> GPU -> *xxx*MHz;  
>Можем начинать со значения 460MHz. Установили, двигаемся в 4IFIR Miracle -> Miscellaneous; Спускаемся в самый низ и фиксируем значение GPU volt: *xxx*MHz, где xxx - ваше текущее напряжение. (**Данный показатель меняется в зависимости от частоты RAM**)    
>Возвращаемся в Temporary overrides и увеличиваем частоту GPU на один шаг.  
>Проверяем напряжение GPU в Miscellaneous, повторяя эту процедуру до тех пор, пока напряжение не изменится.  
>После этого уменьшаем частоту GPU на один шаг.  
>Таким образом, мы определили максимальную частоту при минимальном напряжении.  
>Теперь можно протестировать игры на этой частоте, обязательно с включенным разгоном RAM. 5-10 минут игры в нескольких играх будет достаточно.  
>Если на каком-либо этапе повышения частоты или теста в игре происходит сбой или зависание, снижаем GPUv. Если нет - повышаем и тестируем дальше.  
* Gpu Eco Mode – выбор уровня андервольта на всей сетке частот видеокарты (чем выше тем агрессивнее андервольт).
>Чем выше значение, тем ниже потребление на частотах. Тесты в играх проводим на частотах выше тех, на которых работает GPUv Mode (Определяли в предыдущем шаге). Рекомендуется также тестировать с выключенным GPU Freq Governor, тестируя примерно 5-10 минут. Если все хорошо, повышаем GPU Eco Mode и тестируем. Если нет - понижаем.
* GPU Overvolt - уровни максимального значения потребления видеокарты
>Оставляем eBamatic, так как профита от утановки вручную вы не получите

### RAM
**Переходим в 4advanced - RAM**  
* RAM Mhz – выбор частоты памяти, которая будет доступна в меню разгона приставки 4IFIR Miracle>Edit app profile/Temporary overrides/Global profile>Memory>4IFIR Optimized.  
>Выбираем нужную частоту, перезагружаемся (шаг назад, пункт Complete[Reboot])  
>После загрузки активируем разгон памяти:  
>4IFIR Miracle -> Temporary overrides -> Memory -> 4IFIR Optimized  
>Это временный разгон, который слетит после перезагрузки.  
>Также можно выставить разгон в 4IFIR Miracle -> Global Profile -> [Hendheld/Docked](портатив/док) Memory  
>В таком случае не нужно будет после перезагрузки выставлять разгон заново и сразу будет видно, работает система с выставленными параметрами либо нет.  
>В шапке оверлея в графе MEM: *xxxx*MHz должно появиться ваше значение. Если все в порядке и консоль не зависла - идём дальше, если нет - жмём кнопку питания консоли 12 секунд до выключения, грузимся через хекату в семи-сток и выбираем значение RAM в Wizard на ступень ниже.    
>Тесты на стабильность: MemBench - прогнать несколько раз и зафиксировать значения  
>Игры (важно). Тестируем в течение 10-15 минут в чувствительных к RAM играх (RDR). Если все хорошо (нет артефактов и зависаний), переходим дальше. Если нет - выбираем частоту RAM на ступень ниже.    
* RAM Vddq – Напряжение питания памяти. Чем ниже значение, тем ниже потребление.  
>Поочередно снижаете значения на шаг вниз и тестируете на стабильность.  
* RAM Vdd2 – Выбор максимального порога потребления памяти. Чем ниже значение, тем ниже потребление.   
>Поочередно снижаете значения на шаг вниз и тестируете на стабильность.   
* Ebalance – набор оптимизаций работы памяти в соотношении энергоэффективность производительность. Имеется список из 5 значений. 0(eBamatic) – умный режим, автоматически выбирает подходящий eBal, для выбранной частоты. 1 – Добавляет производительности, требует более высоких вольтажей RAM(Можно попробовать, на низких частотах), 2 – теряет в производительности (относительно eBal 1), но уменьшает потребление(Можно попробовать, на большинстве приставок стабильна), 3 – Default , 4 – Для высоких частот (для игры в доке).      
>Чем выше eBAL, тем выше можно взять частоту.    
>По умолчанию установлено значение 0 (eBamatic - авто, его можно и оставить, от достаточно хорош).     
>Чем ниже значение, тем больше преимуществ вы получаете (увеличится пропускная способность памяти, что является мерилом производительности свича).     
>Если значение 2 работает, попробуйте протестировать его в MemBench и сравнить с предыдущими результатами. Если результаты улучшились, перейдите к MemTest и проверьте производительность в играх.  
* Eba-shift - Корректировка eBal режима, при установки значения в 2, позволяет поднять значение 8-го тайминга  
* EMC DVB Mode - Эта настройка управляет внутренним адаптивным механизмом контроллера оперативной памяти. Выбор более точного значения потребления  
>по умолчанию стоит eBamatic, от ручной настройки профита не будет  
* Core Timings – Настройка таймингов памяти. Имеется восемь таймингов Core Timings 1–8. Тайминги не влияют друг на друга. Настройте каждый параметр по отдельности для достижения максимальной стабильной производительности. Чем выше значение каждого тайминга, тем выше производительность.    
>Начинаем с первого тайминга, повышаем его на один шаг, перезапускаем консоль, тестируем в MemBench несколько раз и фиксируем результаты. Если стало лучше, тестируем в играх. Если все хорошо, повышаем еще на один шаг и повторяем тот же алгоритм.    
>Когда достигаем значения, при котором консоль начинает работать нестабильно, зависать или вылетать, возвращаемся к предыдущему значению. Также может существовать порог, при котором дальнейшее повышение значения тайминга не даст никакого результата. На этом значении можно переходить к следующему таймингу. Остальные тайминги настраиваются по тому же алгоритму.  
